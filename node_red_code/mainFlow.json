[{"id":"ebc59993.22f828","type":"tab","label":"InformationRecieve","disabled":false,"info":"This flow read information from the sensor node.\n\nThe information is recieved in different topics as follows:\n\n- Sensor recieves the information from DH11 and the light sensor.\n- Device recieves the information from the board and the wifi module.\n- Status recieves the retained message with the state of the node (online/offline)."},{"id":"f84b4ccb.962dc","type":"tab","label":"InformationStorage","disabled":false,"info":"This flow storages the info recieved by the\ndifferent sensors in mongoDB."},{"id":"918ee82d.94335","type":"tab","label":"InformationConsult","disabled":false,"info":"This allows to consult the mongoDB database using\na User Interface for different functionalities."},{"id":"fc5c9554.5f0878","type":"mqtt-broker","z":"","name":"","broker":"172.16.53.131","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"afb9672f.6b30b8","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"ESP8256","name":""},{"id":"9ff1b7a4.59f73","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Group G","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":20,"gy":35,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"65944896.b21948","type":"mqtt-broker","z":"","name":"","broker":"172.16.53.48","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"8b71058f.09c5c","type":"ui_group","z":"","name":"Datos","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"d265fb2b.299198","type":"ui_group","z":"","name":"Sensor","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"39f2632.359de1c","type":"ui_group","z":"","name":"Relé","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"9c9f7bbe.944cc8","type":"ui_group","z":"","name":"Dispositivo","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"6def83b.5a9cf7c","type":"ui_group","z":"","name":"Gráfica","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"c99e96e6.5a8ff","type":"ui_group","z":"","name":"MongoDB","tab":"","disp":true,"width":"6","collapse":false},{"id":"5c5d5e36.17e448","type":"ui_group","z":"","name":"Sensor","tab":"66b51c80.afc764","order":3,"disp":true,"width":"12","collapse":false},{"id":"38fd0f0b.c4cd5","type":"ui_group","z":"","name":"WiFi module","tab":"66b51c80.afc764","order":2,"disp":true,"width":"6","collapse":false},{"id":"348ee47f.b26b7c","type":"ui_group","z":"","name":"Board","tab":"66b51c80.afc764","order":1,"disp":true,"width":"6","collapse":false},{"id":"66b51c80.afc764","type":"ui_tab","z":"","name":"Home","icon":"'wi-wu-sunny'","disabled":false,"hidden":false},{"id":"91ab7ca5.f8f52","type":"ui_group","z":"","name":"Database","tab":"66b51c80.afc764","order":4,"disp":true,"width":"12","collapse":false},{"id":"91be434a.02d8e","type":"ui_spacer","name":"spacer","group":"91ab7ca5.f8f52","order":5,"width":"7","height":"1"},{"id":"34e0d1a8.ddf9f6","type":"ui_spacer","name":"spacer","group":"91ab7ca5.f8f52","order":4,"width":"12","height":1},{"id":"2e046966.c89c7e","type":"ui_spacer","name":"spacer","group":"38fd0f0b.c4cd5","order":6,"width":1,"height":1},{"id":"ef435d1e.0b9b5","type":"mqtt in","z":"ebc59993.22f828","name":"","topic":"GRUPOG/BEST_Arduino/device","qos":"2","broker":"fc5c9554.5f0878","x":170,"y":600,"wires":[["777ec87c.8d0e28"]]},{"id":"46396fac.baa6a","type":"mqtt in","z":"ebc59993.22f828","name":"","topic":"GRUPOG/BEST_Arduino/status","qos":"2","broker":"fc5c9554.5f0878","x":170,"y":940,"wires":[["189c1ac8.35f54d"]]},{"id":"c720d7b0.3339f8","type":"mqtt in","z":"ebc59993.22f828","name":"","topic":"GRUPOG/BEST_Arduino/sensor","qos":"2","broker":"fc5c9554.5f0878","x":170,"y":240,"wires":[["3705564e.7aa0d2"]]},{"id":"3705564e.7aa0d2","type":"json","z":"ebc59993.22f828","name":"","property":"payload","action":"","pretty":false,"x":408,"y":241,"wires":[["4d07946e.37263c","8415ed7e.9f47b","cbe28.e67891d8","1a3a9364.7e9fcd"]]},{"id":"777ec87c.8d0e28","type":"json","z":"ebc59993.22f828","name":"","property":"payload","action":"","pretty":false,"x":404,"y":599,"wires":[["ab572be5.060b78","281d66db.ca9712","52731a13.15cb7c","97378069.e637b8","c4908325.ec04a","bbbef191.0bbc68","b7c1d805.44b75","adf122b0.f10658","7efd7e8d.470df8","7759a944.efb09"]]},{"id":"ab572be5.060b78","type":"change","z":"ebc59993.22f828","name":"Extract ap","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.WifiModule.data.ap","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":540,"wires":[["93425f12.5bc69"]]},{"id":"adf122b0.f10658","type":"change","z":"ebc59993.22f828","name":"Extract ssid","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.WifiModule.conf.ssid","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":760,"wires":[["579a0284.d05594"]]},{"id":"bbbef191.0bbc68","type":"change","z":"ebc59993.22f828","name":"Extract ip","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.WifiModule.data.ip","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":620,"wires":[["c22111fb.4f1ce"]]},{"id":"b7c1d805.44b75","type":"change","z":"ebc59993.22f828","name":"Extract rssi","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.WifiModule.data.rssi","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":660,"wires":[["a875a437.79e07"]]},{"id":"c4908325.ec04a","type":"change","z":"ebc59993.22f828","name":"Extract bssid","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.WifiModule.data.bssid","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":580,"wires":[["cc2dd4cd.d892b"]]},{"id":"7efd7e8d.470df8","type":"change","z":"ebc59993.22f828","name":"Extract mqtt_server","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.WifiModule.conf.mqtt_server","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":800,"wires":[["9b94fda4.d9a688"]]},{"id":"281d66db.ca9712","type":"change","z":"ebc59993.22f828","name":"Extract uptime","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.Board.data.uptime","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":360,"wires":[["d2ea0d05.9fd638"]]},{"id":"52731a13.15cb7c","type":"change","z":"ebc59993.22f828","name":"Extract chipID","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.Board.data.chip_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":400,"wires":[["7e6b1f1.30c526"]]},{"id":"97378069.e637b8","type":"change","z":"ebc59993.22f828","name":"Extract deep_sleep_time","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.Board.conf.deep_sleep_time","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":440,"wires":[["b55c2963.8051"]]},{"id":"4d07946e.37263c","type":"change","z":"ebc59993.22f828","name":"Extract luminosity","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.LightSensor.light","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"luminosity","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":643,"y":183,"wires":[["951625dd.bda99"]]},{"id":"e0cfaad1.736f2","type":"ui_gauge","z":"ebc59993.22f828","name":"","group":"5c5d5e36.17e448","order":2,"width":"4","height":"4","gtype":"gage","title":"Temperatura","label":"ºC","format":"{{value}}","min":0,"max":"50","colors":["#6cf0ff","#ffac11","#ea1e1e"],"seg1":"","seg2":"","x":1198,"y":324,"wires":[]},{"id":"4968db58.7bfdb4","type":"ui_chart","z":"ebc59993.22f828","name":"","group":"5c5d5e36.17e448","order":5,"width":"12","height":"6","label":"Sensors","chartType":"line","legend":"true","xformat":"auto","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"100","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#d20000","#2fe9fd","#ffed0f","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":1207,"y":120,"wires":[[],[]]},{"id":"dd6231e5.086b68","type":"ui_gauge","z":"ebc59993.22f828","name":"","group":"5c5d5e36.17e448","order":3,"width":"4","height":"4","gtype":"gage","title":"Humedad","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#d6a956","#438ba3","#114ff0"],"seg1":"","seg2":"","x":1199,"y":271,"wires":[]},{"id":"a684a6d8.bcb058","type":"ui_gauge","z":"ebc59993.22f828","name":"","group":"5c5d5e36.17e448","order":4,"width":"4","height":"4","gtype":"gage","title":"Luminosidad","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#808080","#c4c400","#ffff00"],"seg1":"","seg2":"","x":1199,"y":216,"wires":[]},{"id":"951625dd.bda99","type":"function","z":"ebc59993.22f828","name":"To_Percentage","func":"msg.payload = Math.round((msg.payload/1023*100))\nreturn msg;","outputs":1,"noerr":0,"x":833,"y":101,"wires":[["a684a6d8.bcb058","4968db58.7bfdb4"]]},{"id":"579a0284.d05594","type":"ui_text","z":"ebc59993.22f828","group":"38fd0f0b.c4cd5","order":1,"width":0,"height":0,"name":"","label":"SSID","format":"{{msg.payload}}","layout":"row-spread","x":908,"y":768,"wires":[]},{"id":"a875a437.79e07","type":"ui_text","z":"ebc59993.22f828","group":"38fd0f0b.c4cd5","order":2,"width":0,"height":0,"name":"","label":"RSSI","format":"{{msg.payload}} mdB","layout":"row-spread","x":906,"y":669,"wires":[]},{"id":"93425f12.5bc69","type":"ui_text","z":"ebc59993.22f828","group":"38fd0f0b.c4cd5","order":3,"width":0,"height":0,"name":"","label":"AP","format":"{{value}} ","layout":"row-spread","x":897,"y":533,"wires":[]},{"id":"cc2dd4cd.d892b","type":"ui_text","z":"ebc59993.22f828","group":"348ee47f.b26b7c","order":2,"width":0,"height":0,"name":"","label":"BSSID","format":"{{msg.payload}}","layout":"row-spread","x":902,"y":576,"wires":[]},{"id":"c22111fb.4f1ce","type":"ui_text","z":"ebc59993.22f828","group":"38fd0f0b.c4cd5","order":4,"width":0,"height":0,"name":"","label":"IP","format":"{{msg.payload}}","layout":"row-spread","x":900,"y":616,"wires":[]},{"id":"9b94fda4.d9a688","type":"ui_text","z":"ebc59993.22f828","group":"38fd0f0b.c4cd5","order":5,"width":0,"height":0,"name":"","label":"MQTT server","format":"{{msg.payload}}","layout":"row-spread","x":926,"y":830,"wires":[]},{"id":"d2ea0d05.9fd638","type":"ui_text","z":"ebc59993.22f828","group":"348ee47f.b26b7c","order":3,"width":0,"height":0,"name":"","label":"Uptime","format":"{{value}} ","layout":"row-spread","x":903,"y":375,"wires":[]},{"id":"7e6b1f1.30c526","type":"ui_text","z":"ebc59993.22f828","group":"348ee47f.b26b7c","order":4,"width":0,"height":0,"name":"","label":"chipID","format":"{{value}}","layout":"row-spread","x":903,"y":418,"wires":[]},{"id":"b55c2963.8051","type":"ui_text","z":"ebc59993.22f828","group":"348ee47f.b26b7c","order":5,"width":0,"height":0,"name":"","label":"Deep Sleep Time","format":"{{value}} min","layout":"row-spread","x":948,"y":465,"wires":[]},{"id":"189c1ac8.35f54d","type":"ui_text","z":"ebc59993.22f828","group":"348ee47f.b26b7c","order":6,"width":0,"height":0,"name":"","label":"Status","format":"{{msg.payload}}","layout":"row-spread","x":573,"y":933,"wires":[]},{"id":"cbe28.e67891d8","type":"change","z":"ebc59993.22f828","name":"Extract temperature","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.DH11.temperature","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"temperature","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":661,"y":269,"wires":[["e0cfaad1.736f2","4968db58.7bfdb4"]]},{"id":"8415ed7e.9f47b","type":"change","z":"ebc59993.22f828","name":"Extract humidity","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.body.DH11.humidity","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"humidity","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":629,"y":234,"wires":[["dd6231e5.086b68","4968db58.7bfdb4"]]},{"id":"c281f5ea.b13db8","type":"mongodb out","z":"f84b4ccb.962dc","mongodb":"afb9672f.6b30b8","name":"","collection":"Sensors","payonly":true,"upsert":false,"multi":false,"operation":"store","x":1095.5,"y":292,"wires":[]},{"id":"e0ef476c.e761e8","type":"json","z":"f84b4ccb.962dc","name":"","property":"payload","action":"","pretty":false,"x":606,"y":298,"wires":[["d599af4b.5081c"]]},{"id":"d78ace45.352b1","type":"mqtt in","z":"f84b4ccb.962dc","name":"","topic":"GRUPOG/BEST_Arduino/sensor","qos":"2","broker":"fc5c9554.5f0878","x":323,"y":301,"wires":[[]]},{"id":"354dba72.e70006","type":"ui_button","z":"918ee82d.94335","name":"","group":"91ab7ca5.f8f52","order":6,"width":"3","height":"1","passthru":true,"label":"Actualizar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{}","payloadType":"json","topic":"","x":993,"y":153,"wires":[["a7171934.e46c48"]]},{"id":"5e503af5.8cbb14","type":"mongodb in","z":"918ee82d.94335","mongodb":"afb9672f.6b30b8","name":"","collection":"Sensors","operation":"find","x":296,"y":591,"wires":[["8919bd0.5c4e24","357f9d76.0dddaa","c5d74bc0.be442","bb8ecf20.d96138"]]},{"id":"e2d3539e.9269d","type":"ui_template","z":"918ee82d.94335","group":"91ab7ca5.f8f52","name":"Register","order":7,"width":"12","height":"6","format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1013,"y":439,"wires":[[]]},{"id":"8919bd0.5c4e24","type":"template","z":"918ee82d.94335","name":"lista en formato html","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":" <h1>Registros: </h1>\n <ul>\n{{#payload}}\n  <li>{{header}} : {{body.DH11.temperature}}ºC, {{body.DH11.humidity}}%, A0:{{body.LightSensor.light}}  </li>\n{{/payload}}\n </ul>","output":"str","x":817.5,"y":439,"wires":[["e2d3539e.9269d"]]},{"id":"357f9d76.0dddaa","type":"function","z":"918ee82d.94335","name":"Generar Datos Temp Hum","func":"var arraytemp=[];\nvar arrayhum=[];\n\nif(Array.isArray(msg.payload) && msg.payload.length>0)\n{\n    for (var i = 0; i < msg.payload.length; i++) { // añade datos a los arrays\n        arraytemp.push({x:msg.payload[i].header ,y: msg.payload[i].body.DH11.temperature});\n        arrayhum.push({x:msg.payload[i].header ,y: msg.payload[i].body.DH11.humidity});\n    }\n}\n\n// consultar formato de entrada al Chart en:\n// https://github.com/node-red/node-red-dashboard/blob/master/Charts.md\n\nmsg.payload = [{\n        \"series\":[\"Temperatura\",\"Humedad\"],\n        \"data\":[arraytemp, arrayhum],\n        \"labels\":[\"\"]\n        }];\n\nreturn msg;  ","outputs":"1","noerr":0,"x":694.5,"y":546,"wires":[["385efac9.7bed26"]]},{"id":"385efac9.7bed26","type":"ui_chart","z":"918ee82d.94335","name":"","group":"91ab7ca5.f8f52","order":8,"width":"0","height":"0","label":"Histórico Temp Hum","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#ff0000","#00ffff","#ffff00","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":982,"y":535,"wires":[[],[]]},{"id":"c5d74bc0.be442","type":"function","z":"918ee82d.94335","name":"Generar Datos Lum","func":"var arraylum=[];\n\nif(Array.isArray(msg.payload) && msg.payload.length>0)\n{\n    for (var i = 0; i < msg.payload.length; i++) { // añade datos a los arrays\n        arraylum.push({x:msg.payload[i].header ,y: msg.payload[i].body.LightSensor.light});\n    }\n}\n\n// consultar formato de entrada al Chart en:\n// https://github.com/node-red/node-red-dashboard/blob/master/Charts.md\nmsg.payload = [{\n        \"series\":[\"Luminosidad\"],\n        \"data\":[arraylum],\n        \"labels\":[\"\"]\n        }];\n\nreturn msg;  ","outputs":"1","noerr":0,"x":662.5,"y":614,"wires":[["a18544fb.33f8d8"]]},{"id":"a18544fb.33f8d8","type":"ui_chart","z":"918ee82d.94335","name":"","group":"91ab7ca5.f8f52","order":12,"width":"0","height":"0","label":"Histórico Lum","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#ffff00","#00ffff","#ffff00","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":921.5,"y":613,"wires":[[],[]]},{"id":"bb8ecf20.d96138","type":"function","z":"918ee82d.94335","name":"Generar Min Max Med","func":"var min = 0;\nvar max = 0;\nvar med = 0.0;\n\nif(Array.isArray(msg.payload) && msg.payload.length>0)\n{\n    for (var i = 0; i < msg.payload.length; i++) { // añade datos a los arrays\n        var data = msg.payload[i].body.DH11.temperature;\n        if (data < min || i === 0) {\n            min = data;\n        }\n        if (data > max || i === 0) {\n            max = data;    \n        }\n        med = med + data;\n    }\n    \n    med = Math.round((med/msg.payload.length))\n}\n\nmsg.payload = {};\nmsg.payload.min = min;\nmsg.payload.max = max;\nmsg.payload.med = med;\n\nreturn msg;","outputs":"1","noerr":0,"x":666.5,"y":687,"wires":[["9af994bf.07cf6","3ee637b.a965648","83a2e3e.199902"]]},{"id":"9af994bf.07cf6","type":"ui_text","z":"918ee82d.94335","group":"91ab7ca5.f8f52","order":11,"width":"3","height":"1","name":"","label":"Min","format":"{{msg.payload.min}}","layout":"row-spread","x":880,"y":686,"wires":[]},{"id":"3ee637b.a965648","type":"ui_text","z":"918ee82d.94335","group":"91ab7ca5.f8f52","order":9,"width":"3","height":"1","name":"","label":"Max","format":"{{msg.payload.max}}","layout":"row-spread","x":874,"y":732,"wires":[]},{"id":"83a2e3e.199902","type":"ui_text","z":"918ee82d.94335","group":"91ab7ca5.f8f52","order":10,"width":"3","height":"1","name":"","label":"Med","format":"{{msg.payload.med}}","layout":"row-spread","x":875,"y":788,"wires":[]},{"id":"3a3fdba1.0074c4","type":"inject","z":"918ee82d.94335","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":192.5,"y":821,"wires":[["12244359.d30fa5"]]},{"id":"12244359.d30fa5","type":"mongodb out","z":"918ee82d.94335","mongodb":"afb9672f.6b30b8","name":"","collection":"Sensors","payonly":true,"upsert":false,"multi":false,"operation":"delete","x":479.5,"y":820,"wires":[]},{"id":"a1f51d4.ccb406","type":"ui_numeric","z":"918ee82d.94335","name":"","label":"Number of messages","tooltip":"","group":"91ab7ca5.f8f52","order":1,"width":"4","height":"1","passthru":true,"topic":"","format":"{{value}}","min":"1","max":"1000","step":1,"x":390,"y":184,"wires":[["bb90412a.9462e"]]},{"id":"a7171934.e46c48","type":"change","z":"918ee82d.94335","name":"Limit and Sort","rules":[{"t":"set","p":"limit","pt":"msg","to":"msgLimit","tot":"global"},{"t":"set","p":"sort","pt":"msg","to":"msgSortMode","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1176,"y":154,"wires":[["5e503af5.8cbb14"]]},{"id":"4c56541a.1be474","type":"ui_dropdown","z":"918ee82d.94335","name":"","label":"","tooltip":"","place":"Select sort mode","group":"91ab7ca5.f8f52","order":2,"width":"4","height":"1","passthru":true,"options":[{"label":"Ascending","value":"{\"header\":1}","type":"str"},{"label":"Descending","value":"{\"header\":-1}","type":"str"}],"payload":"","topic":"","x":341.5,"y":265,"wires":[["ff0ff29a.c5b788"]]},{"id":"bb90412a.9462e","type":"change","z":"918ee82d.94335","name":"SetLimitDB","rules":[{"t":"set","p":"msgLimit","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":758.5,"y":184,"wires":[["354dba72.e70006"]]},{"id":"aae89d21.669988","type":"change","z":"918ee82d.94335","name":"SetSortModeDB","rules":[{"t":"set","p":"msgSortMode","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":264,"wires":[["354dba72.e70006"]]},{"id":"80622d1c.ec462","type":"inject","z":"918ee82d.94335","name":"","topic":"","payload":"10","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":103.5,"y":250,"wires":[["bb90412a.9462e","a1f51d4.ccb406"]]},{"id":"a1f0b0d2.f0b","type":"inject","z":"918ee82d.94335","name":"","topic":"","payload":"{\"header\":1}","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":129,"y":379,"wires":[["4c56541a.1be474","ff0ff29a.c5b788"]]},{"id":"4d92b02c.23d8d","type":"ui_dropdown","z":"918ee82d.94335","name":"","label":"","tooltip":"","place":"Select time frame","group":"91ab7ca5.f8f52","order":3,"width":"4","height":"1","passthru":true,"options":[{"label":"Day","value":0,"type":"num"},{"label":"Week","value":0,"type":"num"},{"label":"Month","value":0,"type":"num"},{"label":"Year","value":0,"type":"num"}],"payload":"","topic":"","x":324,"y":399,"wires":[["e75a8dbd.547ce"]]},{"id":"e75a8dbd.547ce","type":"change","z":"918ee82d.94335","name":"SetSortTimeDB","rules":[{"t":"set","p":"msgSortTime","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":762.5,"y":345,"wires":[[]]},{"id":"70356efd.072ef8","type":"inject","z":"918ee82d.94335","name":"","topic":"","payload":"{\"timestamp\":-1}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":116.5,"y":485,"wires":[["e75a8dbd.547ce","4d92b02c.23d8d"]]},{"id":"d599af4b.5081c","type":"change","z":"f84b4ccb.962dc","name":"","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":804.5,"y":297,"wires":[["c281f5ea.b13db8"]]},{"id":"9b87866f.ab04d8","type":"ui_text","z":"ebc59993.22f828","group":"5c5d5e36.17e448","order":1,"width":0,"height":0,"name":"","label":"Last sensor recieve","format":"{{value}} ","layout":"row-spread","x":1234,"y":371,"wires":[]},{"id":"1a3a9364.7e9fcd","type":"change","z":"ebc59993.22f828","name":"Extract time","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.header","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":634,"y":315,"wires":[["9b87866f.ab04d8","8ce2d756.4a44d"]]},{"id":"9ab6efd8.cfb048","type":"ui_text","z":"ebc59993.22f828","group":"348ee47f.b26b7c","order":1,"width":0,"height":0,"name":"","label":"Last device recieve","format":"{{value}} ","layout":"row-spread","x":1215,"y":899,"wires":[]},{"id":"7759a944.efb09","type":"change","z":"ebc59993.22f828","name":"Extract time","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.header","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":625,"y":843,"wires":[["9ab6efd8.cfb048"]]},{"id":"8ce2d756.4a44d","type":"debug","z":"ebc59993.22f828","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1131.5,"y":45,"wires":[]},{"id":"c246dc7d.7bb6b","type":"inject","z":"918ee82d.94335","name":"","topic":"","payload":"{}","payloadType":"json","repeat":"3","crontab":"","once":true,"onceDelay":0.1,"x":782.5,"y":37,"wires":[["354dba72.e70006"]]},{"id":"ff0ff29a.c5b788","type":"json","z":"918ee82d.94335","name":"","property":"payload","action":"","pretty":false,"x":548.5,"y":266,"wires":[["aae89d21.669988"]]}]
